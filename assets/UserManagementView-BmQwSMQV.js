import{q as K,r,s as L,t as Q,c as W,w as a,V as P,o as X,a as l,e as I,f as Y,g as Z,h as n,v as h,n as x,p as v,x as ee,y as A,z as le,A as B,B as F,C as j,D as ae,i as z,b as te,d as b,l as O,E as u,F as N,m as q,G as w,H as E}from"./index-B1f6o2fm.js";const se={class:"text-h5"},re={__name:"UserManagementView",setup(oe){const d=K(),p=r(10),G=r([{title:"姓名",key:"name"},{title:"電子郵件",key:"email"},{title:"角色",key:"role"},{title:"狀態",key:"status"},{title:"操作",key:"actions",sortable:!1}]),V=r([]),i=r(!0),D=r(0),C=r(""),g=r(!1),c=r(!1),k={id:null,name:"",email:"",role:"Viewer",status:"Active"};let s=L({...k});const m=r(-1),H=Q(()=>m.value===-1?"新增使用者":"編輯使用者");async function y({page:o,itemsPerPage:e,sortBy:t,search:_}){i.value=!0;try{let f=`/users?_page=${o}&_limit=${e}`;t.length>0&&(f+=`&_sort=${t[0].key}&_order=${t[0].order}`),_&&(f+=`&q=${_}`);const $=await w.get(f);V.value=$.data,D.value=parseInt($.headers["x-total-count"])||0}catch(f){console.error("Failed to load users:",f),d.showSnackbar("無法載入使用者資料","error")}finally{i.value=!1}}function S(o){m.value=o?V.value.findIndex(e=>e.id===o.id):-1,Object.assign(s,o||k),g.value=!0}function T(){g.value=!1,E(()=>{Object.assign(s,k),m.value=-1})}async function M(){i.value=!0;try{if(m.value>-1)await w.put(`/users/${s.id}`,s),d.showSnackbar("使用者資料已更新");else{const o={...s};delete o.id,await w.post("/users",o),d.showSnackbar("使用者已新增")}T(),await y({page:1,itemsPerPage:p.value,sortBy:[],search:C.value})}catch(o){console.error("Failed to save user:",o),d.showSnackbar("儲存失敗","error")}finally{i.value=!1}}function R(o){m.value=V.value.findIndex(e=>e.id===o.id),Object.assign(s,o),c.value=!0}function U(){c.value=!1,E(()=>{Object.assign(s,k),m.value=-1})}async function J(){i.value=!0;try{await w.delete(`/users/${s.id}`),d.showSnackbar("使用者已刪除"),U(),await y({page:1,itemsPerPage:p.value,sortBy:[],search:C.value})}catch(o){console.error("Failed to delete user:",o),d.showSnackbar("刪除失敗","error")}finally{i.value=!1}}return(o,e)=>(X(),W(P,{fluid:""},{default:a(()=>[l(I,{rounded:"lg"},{default:a(()=>[l(Y,{flat:""},{default:a(()=>[l(Z,null,{default:a(()=>e[8]||(e[8]=[n("使用者列表",-1)])),_:1,__:[8]}),l(h,{class:"mx-4",inset:"",vertical:""}),l(x),l(v,{color:"primary",onClick:e[0]||(e[0]=t=>S())},{default:a(()=>e[9]||(e[9]=[n("新增使用者",-1)])),_:1,__:[9]})]),_:1}),l(ee,{"items-per-page":p.value,"onUpdate:itemsPerPage":e[1]||(e[1]=t=>p.value=t),headers:G.value,items:V.value,"items-length":D.value,loading:i.value,search:C.value,"item-value":"id","onUpdate:options":y},{"item.status":a(({value:t})=>[l(le,{color:t==="Active"?"green":"red",size:"small"},{default:a(()=>[n(B(t),1)]),_:2},1032,["color"])]),"item.actions":a(({item:t})=>[l(A,{size:"small",class:"mr-2",onClick:_=>S(t)},{default:a(()=>e[10]||(e[10]=[n("mdi-pencil",-1)])),_:2,__:[10]},1032,["onClick"]),l(A,{size:"small",onClick:_=>R(t)},{default:a(()=>e[11]||(e[11]=[n("mdi-delete",-1)])),_:2,__:[11]},1032,["onClick"])]),_:1},8,["items-per-page","headers","items","items-length","loading","search"])]),_:1}),l(F,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=t=>g.value=t),"max-width":"500px"},{default:a(()=>[l(I,null,{default:a(()=>[l(j,null,{default:a(()=>[ae("span",se,B(H.value),1)]),_:1}),l(z,null,{default:a(()=>[l(P,null,{default:a(()=>[l(te,null,{default:a(()=>[l(b,{cols:"12"},{default:a(()=>[l(O,{modelValue:u(s).name,"onUpdate:modelValue":e[2]||(e[2]=t=>u(s).name=t),label:"姓名"},null,8,["modelValue"])]),_:1}),l(b,{cols:"12"},{default:a(()=>[l(O,{modelValue:u(s).email,"onUpdate:modelValue":e[3]||(e[3]=t=>u(s).email=t),label:"電子郵件"},null,8,["modelValue"])]),_:1}),l(b,{cols:"12",sm:"6"},{default:a(()=>[l(N,{modelValue:u(s).role,"onUpdate:modelValue":e[4]||(e[4]=t=>u(s).role=t),items:["Admin","Editor","Viewer"],label:"角色"},null,8,["modelValue"])]),_:1}),l(b,{cols:"12",sm:"6"},{default:a(()=>[l(N,{modelValue:u(s).status,"onUpdate:modelValue":e[5]||(e[5]=t=>u(s).status=t),items:["Active","Inactive"],label:"狀態"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(q,null,{default:a(()=>[l(x),l(v,{color:"blue-darken-1",variant:"text",onClick:T},{default:a(()=>e[12]||(e[12]=[n("取消",-1)])),_:1,__:[12]}),l(v,{color:"blue-darken-1",variant:"text",onClick:M},{default:a(()=>e[13]||(e[13]=[n("儲存",-1)])),_:1,__:[13]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(F,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value=t),"max-width":"500px"},{default:a(()=>[l(I,null,{default:a(()=>[l(j,{class:"text-h5"},{default:a(()=>e[14]||(e[14]=[n("確定要刪除此使用者嗎？",-1)])),_:1,__:[14]}),l(z,null,{default:a(()=>e[15]||(e[15]=[n("此操作無法復原。",-1)])),_:1,__:[15]}),l(q,null,{default:a(()=>[l(x),l(v,{color:"blue-darken-1",variant:"text",onClick:U},{default:a(()=>e[16]||(e[16]=[n("取消",-1)])),_:1,__:[16]}),l(v,{color:"red-darken-1",variant:"text",onClick:J},{default:a(()=>e[17]||(e[17]=[n("刪除",-1)])),_:1,__:[17]}),l(x)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{re as default};
